function $_GET(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}var app=angular.module("app",["ngRoute","ngAnimate","ngSanitize"]);app.directive("ngShow",function(){return{restrict:"E",templateUrl:templateURL+"listings-grid.php"}}),app.directive("googleplace",function(){return{require:"ngModel",link:function(e,t,a,n){var l={types:[]};e.gPlace=new google.maps.places.Autocomplete(t[0],l),google.maps.event.addListener(e.gPlace,"place_changed",function(){var a=e.gPlace.getPlace(),l=a.geometry.location.lat(),s=a.geometry.location.lng(),o=a.address_components;(o=o.filter(function(e){switch(e.types[0]){case"locality":case"administrative_area_level_1":case"country":return!0;default:return!1}}).map(function(e){return e.long_name})).push(l,s),e.$apply(function(){e.details=o,n.$setViewValue(t.val())})})}}}),app.controller("theMap",["$window","$q","$http","$timeout","$scope","$rootScope",function(e,t,a,n,l,s){l.showPlaces=function(){l.$cat=$_GET("thecat"),l.$subcat=$_GET("subcat"),l.$theCat="undefined"===l.$subcat||""===l.$subcat||"-"===l.$subcat?l.$cat:l.$subcat,a.get("wp-json/wp/v2/le_place/?filter[category_slug]="+l.$theCat).success(function(e){e.length>l.postPerPage?l.noResult=!1:l.noResult=!0;var t={zoom:15,center:new google.maps.LatLng(window.latDest,window.longDest),mapTypeId:google.maps.MapTypeId.TERRAIN};l.map=new google.maps.Map(document.getElementById("map"),t),l.markers=[];var a=new google.maps.InfoWindow;for(i=0;i<e.length;i++)!function(t,n,s){var o=new google.maps.Marker({map:l.map,position:new google.maps.LatLng(t,n),title:s});o.content='<div class="infoWindowContent">'+e[i].acf.location.address+"<br><strong>Phone:</strong> "+e[i].acf.phone+"</div>",google.maps.event.addListener(o,"click",function(){a.setContent("<h6>"+s+"</h6>"+o.content),a.open(l.map,o)}),l.markers.push(o)}(e[i].acf.location.lat,e[i].acf.location.lng,e[i].title.rendered)})}}]),app.controller("searchPlatform",["$window","$q","$http","$timeout","$scope","$rootScope",function(e,t,a,n,l,s){s.templateURL=templateURL,s.siteURL=siteURL,l.loading=!0,l.selectedCatToFilter="",l.postPerPage=3,l.newPosts=[],l.searchKey="",l.defaultThumb=templateURL+"/images/default-thumb.jpg",s.requests=[],l.gPlace,l.selectedCat={slug:"",label:""},l.selectedSubCat={slug:"",label:""},l.busyPage=function(){return a.pendingRequests.length>0},l.$watch(l.busyPage,function(e){l.busyPage=!!e}),l.disableSubCat=!0,l.initCats=!0,l.cats=[{id:-1,name:"All Categories",slug:"",isDefault:!0}],l.subCats=[{id:-1,name:"ALL Tags",slug:"",isDefault:!0}],l.setCat=function(e,t,a){l.selectedCat.slug=e,l.selectedCat.label=t,l.selectedCat.id=a,l.initCats=!1,l.selectedSubCat={slug:"",label:""},l.disableSubCat=!0,l.selectedCatToFilter=a},l.enableSubCats=function(){l.disableSubCat=!1},l.setSubCat=function(e,t,a){l.selectedSubCat.slug=e,l.selectedSubCat.label=t,l.selectedCatToFilter=a},l.getCats=function(){siteUrl="//www.agespace.org/",a.get(siteUrl+"wp-json/wp/v2/category/?per_page=100").success(function(e){l.cats=l.cats.concat(e)})},l.checkCatHasChild=function(e,t){angular.forEach(l.cats,function(e,t){if(e.id===t.parent)return!0})},l.search=function(){l.selectedSubCat.slug=""===l.selectedSubCat.slug||void 0===l.selectedSubCat.slug?"-":l.selectedSubCat.slug;var t=l.selectedCat.slug+"/near/"+l.details[0].toLowerCase()+"/25/"+l.details[l.details.length-2]+"/"+l.details[l.details.length-1];e.location.href="/location-results/"+t}}]);